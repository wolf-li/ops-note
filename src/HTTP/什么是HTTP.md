# 什么是 HTTP

## 在浏览器中打开一个网站（域名）会发生什么事情？

* 浏览器访问 DNS 服务器，对网站域名进行解析
* 浏览器请求计算机建立对这个IP地址的标准 Web 端口（80）或标准安全 Web 端口（443）的TCP的连接
* 浏览器连接到网站的 Web 服务器之后，会请求网站，这一步就用到 HTTP。
* Web 服务器会根据请求的 URL 响应相关内容，一般来说，初始响应中包含 HTML 格式的网页文本。HTML 是一种标准化、结构化的基于文本的格式，用于组织页面中的内容。
* 浏览器处理 Web 服务器发送的数据，假设响应的是 HTML ，则浏览器就会解析 HTML 中的代码，并在内存中构建 DOM，一种页面的内部表现形式。处理期间，浏览器可能会发现显示页面还有其他资源（比如 CSS、JS和图片等）
* 浏览器向 Web 服务器请求其他资源（CSS JS 图片），请求每个资源都要重复以上步骤。
* 浏览器接收足够资源后，开始在屏幕上渲染页面，选择在屏幕上渲染等时机又是另一个挑战。
* 在页面刚刚显示在屏幕上后，浏览器会在后台继续下载其他资源，并在处理完成他们后更新页面，这些资源包括不重要的图片和广告追踪脚本。
* 当页面完全被加载后，浏览器会停止显示加载图标，然后触发 OnLoad JavaScript 事件。根据这个事件， JavaScript 就可以知道可以执行那些操作了。
* 此时页面被完全加载，但浏览器并不会停止发送请求，网页只包含静态资源的时代过去了，很多功能都是后台运行，如 Google 主页的搜索框中填写了一个关键字，但没有按搜索按钮就立即看到了搜索建议，有的来自应用驱动操作，比如 Facebook 或 twitter 账户状态更新，不需要你手动点击。

HTTP代表超文本传输协议，HTTP最初是用来传输超文本文档的（文档中包含指向其他文档的连接）HTTP的第一个版本，除了这些文档外不支持其它类型内容。
HTTP 基于可靠的网络连接，通常由 TCP/IP 提供，而 TCP/IP 建立在某种物理连接上（以太网、Wi-Fi等）因为通信协议被分到不同的层，所以每一层都可以专注做好当前层的事，HTTP 不关心如何建立网络连接的底层细节。基于 HTTP 的应用应该关注如何处理网络错误或者连接错误，而协议本身并不考虑这些事情。

OSI 模型描述 Web 流量对应
7 - 应用层 - 超文本传输协议（HTTP）
6 - 表现层 - 文件格式如 ASCII、UTF-8、JPG、PNG等
5 - 会话层 - 安全套接层 SSL/ 安全传输协议 TLS
4 - 传输层 - 传输控制协议 TCP
3 - 网络层 - 因特网协议 IP
2 - 数据链路层 - 以太网
1 - 物理层 - 网线、空气，光纤

## HTTP 的语法和历史

### HTTP/0.9

HTTP的第一个规范是 1991 年发布的 0.9 版本。该规范指定，通过 TCP/IP （或类似的面向连接的服务）与服务器和端口（可选定，默认 80）建立连接，客户端应发送一行 ASCII 文本，包括 GET、文档地址（无空格）、回车符和换行符（回车是可选的）。服务器使用 HTML 格式的消息进行响应，该消息被定义为“ASCII字符的字节流”。规范还指定，“通过服务关闭连接来终止消息”，在处理错误时，规范声明：“错误响应可以可读的文本显示”，使用 HTML 语法。除了文本的内容，没有办法的区分错误响应和正确的响应。请求是幂等的。服务器不需要在断开连接后存储关于请求的任何信息，规范为我们提供了 HTTP 的无状态特性，这是一把双刃剑，请求简单，，必须用 HTTP cookie 登记似乎以允许状态跟踪，这时没有 HTTP 首部或其他任何媒体概念。

### HTTP/1.0

1996年5月发布 RFC 1945，增加了一些新的关键特性：

* 更多的请求方法，除了先前定义的 GET 方法，新增了 HEAD 和 POST 方法。
* 为所有消息添加 HTTP 版本号字段。此字段是可选的，为了向后兼容，默认情况下使用 HTTP/0.9
* HTTP 首部，它可以与请求和响应一起发送，以提供与正在执行的请求或发送的响应相关的更多信息
* 一个三位整数的响应状态码，（例如）用来表示响应是否成功。此状态码还可以用来表示重定向请求，条件请求和错误状态（404 NOT FOUND）
  
### HTTP/1.1

HTTP1.1首个规范发布于 1997年1月，于1999年6月被新版替换，然后 2014年6月发布第三个版本，现在还有新版本发布。
重要特性：

* 强制添加 Host 首部

HTTP请求行（如 GET指令）中的 URL 不是一个包含绝对路径的 URL，而是一个包含相对路径的 URL 如 （/index.html）。一个 Web 服务器只能托管一个网站。所以 URL 的主机部分是不言自明的，因为在发送 HTTP 请求之前，用户肯定已经连接到了主机。如今一个 Web 服务器部署多个网站明确那个网站访问那个 URL 很重要。此功能可通过在首部中添加 Host 来实现该功能。

```bash
GET / HTTP/1.1
Host: www.google.com
```

* 持久连接（Keep-alive）
HTTP中的另外一个被很多 HTTP1.0 支持持久连接，没有包含在规范中。网站内容媒体内容变得丰富后，关闭连接是一种浪费性能的行为。显示一个页面需要多个资源，所以关闭连接之后还要重新打开它，这导致了不必要的延迟。这个问题被一个新的 Connection 首部解决了，这个 HTTP 首部可以随着 HTTP/1.0 的请求被发送。通过指定此首部值为 Keep-Alive，客户端可以要求服务器保持连接打开，以支持发送更多请求

```bash
GET /page.html HTTP/1.0
Connection: Keep-Alive
```

服务器如果要关闭连接需要在 HTTP 首部中显示包含 Connection: close HTTP首部：

```bash
HTTP/1.1 200 OK
Date: Sun, 25 Jun 2017 13:30:24 GMT
Connection: close
Content-Type: text/html; charset=UTF-8
Server: Apache

<!doctype html>
...
```

* 定义了新的方法，如 PUT、OPTIONS 和比较少见的 CONNNECT、TRACE 及 DELETE
* 更好的缓存方法这些方法允许服务器指示客户端将资源存储在浏览器的缓存中，以便在需要的时候使用。